# File: aerospace_scoring/seed_columns.yaml
# Define the columns for the output table and data extraction

output_table:
  name: "aerospace_supplier_candidates"
  description: "Tier-2 aerospace supplier candidates from UK OSM data"

# Core identification columns
identification_columns:
  - column_name: "osm_id"
    source_column: "osm_id"
    data_type: "bigint"
    description: "Original OSM object ID"
    
  - column_name: "osm_type"
    source_column: "source_table"
    data_type: "varchar(50)"
    description: "Source OSM table (point/polygon/line)"
    
  - column_name: "name"
    source_column: "name"
    data_type: "text"
    description: "Primary name of the entity"
    fallback_columns: ["operator", "brand", "company"]
    
  - column_name: "operator"
    source_column: "operator"
    data_type: "text"
    description: "Operating company or organization"

# Contact and location information
contact_columns:
  - column_name: "website"
    source_column: "website"
    data_type: "text"
    description: "Company website URL"
    fallback_columns: ["contact:website", "url"]
    
  - column_name: "phone"
    source_column: "phone"
    data_type: "text"
    description: "Contact phone number"
    fallback_columns: ["contact:phone", "telephone"]
    
  - column_name: "email"
    source_column: "email"
    data_type: "text"
    description: "Contact email address"
    fallback_columns: ["contact:email"]

# Address components
address_columns:
  - column_name: "postcode"
    source_column: "addr:postcode"
    data_type: "varchar(20)"
    description: "UK postal code"
    
  - column_name: "street_address"
    source_column: "addr:street"
    data_type: "text"
    description: "Street address"
    
  - column_name: "city"
    source_column: "addr:city"
    data_type: "text"
    description: "City or town"
    fallback_columns: ["addr:town", "place"]
    
  - column_name: "county"
    source_column: "addr:county"
    data_type: "text"
    description: "County or region"
    fallback_columns: ["addr:state", "addr:region"]

# Industrial classification
classification_columns:
  - column_name: "landuse_type"
    source_column: "landuse"
    data_type: "text"
    description: "Land use classification"
    
  - column_name: "building_type"
    source_column: "building"
    data_type: "text"
    description: "Building type classification"
    
  - column_name: "industrial_type"
    source_column: "industrial"
    data_type: "text"
    description: "Specific industrial classification"
    fallback_columns: ["craft", "manufacturing"]
    
  - column_name: "office_type"
    source_column: "office"
    data_type: "text"
    description: "Office/business type"

# Descriptive information
descriptive_columns:
  - column_name: "description"
    source_column: "description"
    data_type: "text"
    description: "Descriptive text about the facility"
    
  - column_name: "brand"
    source_column: "brand"
    data_type: "text"
    description: "Brand or company name"

# Spatial data
spatial_columns:
  - column_name: "geometry"
    source_column: "way"
    data_type: "geometry"
    description: "PostGIS geometry (points, polygons, lines)"
    
  - column_name: "centroid"
    source_expression: "ST_Centroid(way)"
    data_type: "geometry"
    description: "Centroid point for all geometry types"
    
  - column_name: "area_sqm"
    source_expression: "ST_Area(way)"
    data_type: "double precision"
    description: "Area in square meters (for polygons)"
    
  - column_name: "latitude"
    source_expression: "ST_Y(ST_Transform(ST_Centroid(way), 4326))"
    data_type: "double precision"
    description: "Latitude in WGS84"
    
  - column_name: "longitude"
    source_expression: "ST_X(ST_Transform(ST_Centroid(way), 4326))"
    data_type: "double precision"
    description: "Longitude in WGS84"

# Scoring and analysis columns
scoring_columns:
  - column_name: "aerospace_score"
    source_expression: "computed"
    data_type: "integer"
    description: "Computed aerospace relevance score"
    
  - column_name: "tier_classification"
    source_expression: "computed"
    data_type: "varchar(50)"
    description: "Supplier tier classification"
    
  - column_name: "match_keywords"
    source_expression: "computed"
    data_type: "text[]"
    description: "Array of matched aerospace keywords"
    
  - column_name: "confidence_level"
    source_expression: "computed"
    data_type: "varchar(20)"
    description: "Confidence level (high/medium/low)"

# Metadata columns
metadata_columns:
  - column_name: "created_at"
    source_expression: "NOW()"
    data_type: "timestamp"
    description: "Record creation timestamp"
    
  - column_name: "data_source"
    source_expression: "'UK OSM'"
    data_type: "varchar(50)"
    description: "Source of the data"
    
  - column_name: "processing_notes"
    source_expression: "computed"
    data_type: "text"
    description: "Notes about data processing and scoring"

# Column processing rules
processing_rules:
  text_cleaning:
    - remove_html_tags: true
    - trim_whitespace: true
    - normalize_case: "title"
    
  keyword_extraction:
    - extract_aerospace_terms: true
    - identify_company_types: true
    - flag_tier1_suppliers: true
    
  geographic_enhancement:
    - derive_postcode_area: true
    - calculate_industrial_cluster: true
    - determine_region: true

# Data validation rules
validation_rules:
  required_fields:
    - "name"  # Must have a name or operator
    - "geometry"  # Must have spatial data
    
  data_quality_checks:
    - min_name_length: 3
    - max_name_length: 200
    - valid_postcode_format: true
    - valid_geometry: true
    
  business_rules:
    - exclude_residential_postcodes: true
    - flag_duplicate_locations: true
    - verify_uk_bounds: true