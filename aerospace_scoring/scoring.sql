-- Aerospace Supplier Scoring SQL
-- Generated: 2025-10-02T10:36:55.871337
-- Schema: public

-- Scored view for planet_osm_point
DROP VIEW IF EXISTS public.planet_osm_point_aerospace_scored CASCADE;
CREATE VIEW public.planet_osm_point_aerospace_scored AS
SELECT
  src.*,
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology')) THEN 70
    WHEN (src."landuse" IN ('industrial')) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) AS aerospace_score,
  ARRAY[]::text[] AS matched_keywords,
  'planet_osm_point'              AS source_table
FROM public.planet_osm_point_aerospace_filtered flt
JOIN public.planet_osm_point src ON flt.osm_id = src.osm_id
WHERE
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology')) THEN 70
    WHEN (src."landuse" IN ('industrial')) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) > 0;

-- Scored view for planet_osm_line
DROP VIEW IF EXISTS public.planet_osm_line_aerospace_scored CASCADE;
CREATE VIEW public.planet_osm_line_aerospace_scored AS
SELECT
  src.*,
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."industrial" IN ('engineering','electronics','precision','high_tech') OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology') OR src."building" IN ('industrial','factory','warehouse')) THEN 70
    WHEN (src."landuse" IN ('industrial') OR src."building" IN ('industrial','warehouse','manufacture') OR src."industrial" IS NOT NULL) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL OR src."building" IN ('house','apartments','residential','hotel','retail')) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) AS aerospace_score,
  ARRAY[]::text[] AS matched_keywords,
  'planet_osm_line'              AS source_table
FROM public.planet_osm_line_aerospace_filtered flt
JOIN public.planet_osm_line src ON flt.osm_id = src.osm_id
WHERE
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."industrial" IN ('engineering','electronics','precision','high_tech') OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology') OR src."building" IN ('industrial','factory','warehouse')) THEN 70
    WHEN (src."landuse" IN ('industrial') OR src."building" IN ('industrial','warehouse','manufacture') OR src."industrial" IS NOT NULL) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL OR src."building" IN ('house','apartments','residential','hotel','retail')) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) > 0;

-- Scored view for planet_osm_polygon
DROP VIEW IF EXISTS public.planet_osm_polygon_aerospace_scored CASCADE;
CREATE VIEW public.planet_osm_polygon_aerospace_scored AS
SELECT
  src.*,
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."industrial" IN ('engineering','electronics','precision','high_tech') OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology') OR src."building" IN ('industrial','factory','warehouse')) THEN 70
    WHEN (src."landuse" IN ('industrial') OR src."building" IN ('industrial','warehouse','manufacture') OR src."industrial" IS NOT NULL) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL OR src."building" IN ('house','apartments','residential','hotel','retail')) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) AS aerospace_score,
  ARRAY[]::text[] AS matched_keywords,
  'planet_osm_polygon'              AS source_table
FROM public.planet_osm_polygon_aerospace_filtered flt
JOIN public.planet_osm_polygon src ON flt.osm_id = src.osm_id
WHERE
  (
    CASE
    WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%bae%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%safran%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%')) OR src."office" IN ('aerospace','aviation')) THEN 100
    WHEN ((LOWER(src."name") LIKE LOWER('%defense%') OR LOWER(src."name") LIKE LOWER('%defence%') OR LOWER(src."name") LIKE LOWER('%military%') OR LOWER(src."name") LIKE LOWER('%radar%') OR LOWER(src."name") LIKE LOWER('%missile%') OR LOWER(src."name") LIKE LOWER('%weapons%')) OR src."military" IS NOT NULL OR src."landuse" IN ('military')) THEN 80
    WHEN ((LOWER(src."name") LIKE LOWER('%engineering%') OR LOWER(src."name") LIKE LOWER('%technology%') OR LOWER(src."name") LIKE LOWER('%systems%') OR LOWER(src."name") LIKE LOWER('%electronics%') OR LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%advanced%')) OR src."industrial" IN ('engineering','electronics','precision','high_tech') OR src."man_made" IN ('works','factory') OR src."office" IN ('engineering','research','technology') OR src."building" IN ('industrial','factory','warehouse')) THEN 70
    WHEN (src."landuse" IN ('industrial') OR src."building" IN ('industrial','warehouse','manufacture') OR src."industrial" IS NOT NULL) THEN 50
    WHEN ((LOWER(src."name") LIKE LOWER('%research%') OR LOWER(src."name") LIKE LOWER('%development%') OR LOWER(src."name") LIKE LOWER('%laboratory%') OR LOWER(src."name") LIKE LOWER('%institute%') OR LOWER(src."name") LIKE LOWER('%university%')) OR src."office" IN ('research','engineering') OR src."amenity" IN ('research_institute','university')) THEN 60
    ELSE 0
END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%boeing%') OR LOWER(src."name") LIKE LOWER('%airbus%') OR LOWER(src."name") LIKE LOWER('%rolls royce%') OR LOWER(src."name") LIKE LOWER('%bae systems%') OR LOWER(src."name") LIKE LOWER('%leonardo%') OR LOWER(src."name") LIKE LOWER('%thales%') OR LOWER(src."name") LIKE LOWER('%safran%')) OR (LOWER(src."operator") LIKE LOWER('%boeing%') OR LOWER(src."operator") LIKE LOWER('%airbus%') OR LOWER(src."operator") LIKE LOWER('%rolls royce%') OR LOWER(src."operator") LIKE LOWER('%bae systems%') OR LOWER(src."operator") LIKE LOWER('%leonardo%') OR LOWER(src."operator") LIKE LOWER('%thales%') OR LOWER(src."operator") LIKE LOWER('%safran%'))) THEN 50 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%aerospace%') OR LOWER(src."name") LIKE LOWER('%aviation%') OR LOWER(src."name") LIKE LOWER('%aircraft%') OR LOWER(src."name") LIKE LOWER('%avionics%') OR LOWER(src."name") LIKE LOWER('%turbine%') OR LOWER(src."name") LIKE LOWER('%engine%')) OR (LOWER(src."operator") LIKE LOWER('%aerospace%') OR LOWER(src."operator") LIKE LOWER('%aviation%') OR LOWER(src."operator") LIKE LOWER('%aircraft%') OR LOWER(src."operator") LIKE LOWER('%avionics%') OR LOWER(src."operator") LIKE LOWER('%turbine%') OR LOWER(src."operator") LIKE LOWER('%engine%'))) THEN 30 ELSE 0 END +
    CASE WHEN ((LOWER(src."name") LIKE LOWER('%precision%') OR LOWER(src."name") LIKE LOWER('%machining%') OR LOWER(src."name") LIKE LOWER('%casting%') OR LOWER(src."name") LIKE LOWER('%forging%') OR LOWER(src."name") LIKE LOWER('%composite%') OR LOWER(src."name") LIKE LOWER('%materials%')) OR (LOWER(src."operator") LIKE LOWER('%precision%') OR LOWER(src."operator") LIKE LOWER('%machining%') OR LOWER(src."operator") LIKE LOWER('%casting%') OR LOWER(src."operator") LIKE LOWER('%forging%') OR LOWER(src."operator") LIKE LOWER('%composite%') OR LOWER(src."operator") LIKE LOWER('%materials%'))) THEN 20 ELSE 0 END +
    CASE WHEN (src."amenity" IN ('restaurant','pub','cafe','bar','fast_food','fuel','hospital','school') OR src."shop" IS NOT NULL OR src."tourism" IS NOT NULL OR src."leisure" IS NOT NULL OR src."building" IN ('house','apartments','residential','hotel','retail')) THEN -50 ELSE 0 END +
    CASE WHEN (src."landuse" IN ('residential','retail','commercial','farmland')) THEN -25 ELSE 0 END +
    CASE WHEN (src."office" IN ('insurance','finance','estate_agent','lawyer','accountant') OR src."amenity" IN ('bank','post_office','library')) THEN -15 ELSE 0 END
) > 0;
